@model Models.ContactMessage
@inject MCan.Services.JsonLocalizationService Localizer
@using System.Globalization

@{
    var isArabic = CultureInfo.CurrentUICulture.TwoLetterISOLanguageName == "ar";
    var dir = isArabic ? "rtl" : "ltr";
    var textAlign = isArabic ? "text-end" : "text-start";
    var iconMarginClass = isArabic ? "ms-3" : "me-3"; 
}

<!-- Contact Section -->
<section id="contact" class="contact section" dir="@dir">
    <div class="container section-title" data-aos="fade-up">
        <h2>@Localizer.Get("contact title")</h2>
        <p>@Localizer.Get("contact subtitle")</p>
    </div>

    <div class="container" data-aos="fade-up" data-aos-delay="100">
        <div class="mb-4" data-aos="fade-up" data-aos-delay="200">
            <iframe style="border:0; width:100%; height:270px;"
                    src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d605.0192794495807!2d31.692899730228003!3d26.552331440807993!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sar!2seg!4v1761554031005!5m2!1sar!2seg"
                    allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
        </div>

        <div class="row gy-4">
            <!-- Contact Info -->
            <div class="col-lg-4">
                <div class="info-item d-flex mb-3" data-aos="fade-up" data-aos-delay="300">
                    <i class="bi bi-geo-alt flex-shrink-0 me-3 @iconMarginClass"></i>
                    <div class="@textAlign">
                        <h3>@Localizer.Get("contact info address")</h3>
                        <p>@Localizer.Get("contact info addressValue")</p>
                    </div>
                </div>

                <div class="info-item d-flex mb-3" data-aos="fade-up" data-aos-delay="400">
                    <i class="bi bi-telephone flex-shrink-0 me-3 @iconMarginClass"></i>
                    <div class="@textAlign">
                        <h3>@Localizer.Get("contact info call")</h3>
                        <p>@Localizer.Get("contact info callValue1")</p>
                        <p>@Localizer.Get("contact info callValue2")</p>
                        <p>@Localizer.Get("contact info callValue3")</p>
                    </div>
                </div>

                <div class="info-item d-flex mb-3" data-aos="fade-up" data-aos-delay="500">
                    <i class="bi bi-envelope flex-shrink-0 me-3 @iconMarginClass"></i>
                    <div class="@textAlign">
                        <h3>@Localizer.Get("contact info email")</h3>
                        <p>@Localizer.Get("contact info emailValue")</p>
                    </div>
                </div>
            </div>

            <!-- Contact Form -->
            <div class="col-lg-8">
                <form method="post" id="contactForm" class="custom-contact-form" data-aos="fade-up" data-aos-delay="200">
                    @Html.AntiForgeryToken()
                    <div class="row gy-3">
                        <div class="col-md-6">
                            <input asp-for="Name" class="form-control" placeholder="@Localizer.Get("contact form namePlaceholder")" required />
                            <span asp-validation-for="Name" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <input asp-for="Email" class="form-control" placeholder="@Localizer.Get("contact form emailPlaceholder")" required />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>
                        <div class="col-md-12">
                            <input asp-for="PhoneNumber" class="form-control" placeholder="@Localizer.Get("contact form phonePlaceholder")" required />
                            <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                        </div>
                        <div class="col-md-12">
                            <textarea asp-for="Message" class="form-control" rows="6" placeholder="@Localizer.Get("contact form messagePlaceholder")" required></textarea>
                            <span asp-validation-for="Message" class="text-danger"></span>
                        </div>
                        <div class="col-md-12 text-center mt-3">
                            <div class="loading" style="display:none;">Loading...</div>
                            <button type="submit" class="btn btn-primary">@Localizer.Get("contact form sendButton")</button>
                        </div>
                    </div>
                </form>
                <div id="formStatus" class="text-center mt-2" style="display:none;"></div>
            </div>
        </div>
    </div>
</section>

<!-- Optional: Load More Clients Script -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $("#contactForm").submit(function (e) {
            e.preventDefault(); // منع إعادة تحميل الصفحة

            var form = $(this);
            var url = form.attr('action') || '/Contact/Create'; // رابط الأكشن

            $(".loading").show();
            $("#formStatus").hide().text('');

            $.ajax({
                type: "POST",
                url: url,
                data: form.serialize(), // يرسل بيانات الفورم
                success: function (response) {
                    $(".loading").hide();

                    if (response.success) {
                        $("#formStatus").show().removeClass('text-danger').addClass('text-success').text(response.message);
                        form[0].reset(); // إعادة تهيئة الفورم
                    } else {
                        let errors = '';
                        $.each(response.errors, function (key, val) {
                            errors += val + '<br/>';
                        });
                        $("#formStatus").show().removeClass('text-success').addClass('text-danger').html(errors);
                    }
                },
                error: function () {
                    $(".loading").hide();
                    $("#formStatus").show().removeClass('text-success').addClass('text-danger').text('حدث خطأ أثناء إرسال الرسالة.');
                }
            });
        });
    });
</script>
